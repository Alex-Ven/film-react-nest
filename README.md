# üé¨ –ê—Ñ–∏—à–∞ –§–∏–ª—å–º–æ–≤ (Film Afisha)

–ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –¥–æ–∫–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ "–ê—Ñ–∏—à–∞ —Ñ–∏–ª—å–º–æ–≤", —Å–æ—Å—Ç–æ—è—â–µ–µ –∏–∑:
- **–ë—ç–∫–µ–Ω–¥–∞** –Ω–∞ NestJS
- **–§—Ä–æ–Ω—Ç–µ–Ω–¥–∞** –Ω–∞ Vite (React –∏–ª–∏ Vue)
- **PostgreSQL** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- **pgAdmin** –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –ë–î
- **Nginx** –¥–ª—è —Ä–∞–∑–¥–∞—á–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –∏ –ø—Ä–æ–∫—Å–∏ API

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–≤–∞ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã:  
‚úîÔ∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (`frontend-dev`)  
‚úîÔ∏è –ü—Ä–æ–¥–∞–∫—à–Ω (`frontend-build`, `nginx`)  

–¢–∞–∫–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤—ã–±–æ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ `.env`:  
üì¶ PostgreSQL *(–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)*  
üì¶ MongoDB *(–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)*

---

## üì¶ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- NestJS
- React / Vite
- TypeScript
- TypeORM
- PostgreSQL
- MongoDB
- Docker + Docker Compose
- Nginx
- GitHub Actions (CI/CD)

---

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:

```bash
git clone https://github.com/–≤–∞—à-—é–∑–µ—Ä/film-react-nest.git
cd film-react-nest
```

### 2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env`:

```bash
cp .env.example .env
```

–ò–∑–º–µ–Ω–∏—Ç–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è.

---

## üîß –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ PostgreSQL:

```bash
docker-compose --profile postgres --profile frontend-dev up -d --build
```

- –§—Ä–æ–Ω—Ç–µ–Ω–¥ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:5173
- –ë—ç–∫–µ–Ω–¥: http://localhost:3000/api/afisha/films
- pgAdmin: http://localhost:8080
  - Email: `admin@example.com`
  - –ü–∞—Ä–æ–ª—å: `admin`

---

## üåê –ü—Ä–æ–¥–∞–∫—à–Ω —Å–±–æ—Ä–∫–∞

–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–¥–∞–∫—à–Ω –≤–µ—Ä—Å–∏—é —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Nginx:

```bash
docker-compose --profile postgres up -d
```

- –°–∞–π—Ç –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost
- –í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ Nginx

---

## üõ† –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î —á–µ—Ä–µ–∑ `psql`

```bash
docker exec -it film-postgres psql -U prac -d prac
```

### –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

–í–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –±—ç–∫–µ–Ω–¥–∞:

```bash
npm run migration:run
```

> –ú–∏–≥—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞—é—Ç —Ç–∞–±–ª–∏—Ü—ã `films`, `schedules` –∏ –¥–æ–±–∞–≤–ª—è—é—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

---

## üß™ –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ Docker Compose

| –ü—Ä–æ—Ñ–∏–ª—å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|--------|------------|
| `postgres` | –ó–∞–ø—É—Å–∫–∞–µ—Ç PostgreSQL –∏ pgAdmin |
| `mongo` | –ó–∞–ø—É—Å–∫–∞–µ—Ç MongoDB –≤–º–µ—Å—Ç–æ Postgres *(–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)* |
| `frontend-dev` | –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ |
| `frontend-build` | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å Nginx –¥–ª—è production |

---

## üß© CI/CD: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–±–æ—Ä–∫–∞ –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏—è –æ–±—Ä–∞–∑–æ–≤

–ù–∞—Å—Ç—Ä–æ–µ–Ω workflow –≤ GitHub Actions, –∫–æ—Ç–æ—Ä—ã–π:
- –°–æ–±–∏—Ä–∞–µ—Ç –æ–±—Ä–∞–∑—ã `backend`, `frontend`, `nginx`
- –ü—É—à–∏—Ç –∏—Ö –≤ GitHub Container Registry: `ghcr.io/–≤–∞—à-—é–∑–µ—Ä/film-<service>:latest`

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ –ø—É—à–µ –≤ `main`.

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
film-react-nest/
‚îú‚îÄ‚îÄ backend/             # NestJS backend
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îî‚îÄ‚îÄ src/
‚îÇ       ‚îú‚îÄ‚îÄ migrations/
‚îÇ       ‚îî‚îÄ‚îÄ typeorm.config.ts
‚îÇ
‚îú‚îÄ‚îÄ frontend/            # Vite —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îú‚îÄ‚îÄ .env.development
‚îÇ   ‚îî‚îÄ‚îÄ .env.production
‚îÇ
‚îú‚îÄ‚îÄ nginx/               # –ö–æ–Ω—Ñ–∏–≥ Nginx –∏ Dockerfile
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îî‚îÄ‚îÄ nginx.conf
‚îÇ
‚îú‚îÄ‚îÄ public/              # –°—Ç–∞—Ç–∏–∫–∞ (content)
‚îÇ
‚îú‚îÄ‚îÄ docker-compose.yml     # –û—Å–Ω–æ–≤–Ω–æ–π compose-—Ñ–∞–π–ª
‚îú‚îÄ‚îÄ .env                   # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ .env.example           # –®–∞–±–ª–æ–Ω .env
‚îî‚îÄ‚îÄ README.md              # –≠—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ
```

---

## üß™ –ß—Ç–æ –≤–Ω—É—Ç—Ä–∏

### Backend
- API `/api/afisha/films`
- API `/api/afisha/order`
- TypeORM
- JSON-–ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ PostgreSQL –∏ MongoDB

### Frontend
- –†–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ë–î
- –ü–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å `/api/afisha/films`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç CDN-–ø—É—Ç—å `/content/afisha/`

### Nginx
- –ü—Ä–æ–∫—Å–∏—Ä—É–µ—Ç `/api/afisha/...` –Ω–∞ –±—ç–∫–µ–Ω–¥
- –†–∞–∑–¥–∞—ë—Ç —Å—Ç–∞—Ç–∏–∫—É —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

---

## üîÑ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –ë–î

–ß—Ç–æ–±—ã –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ MongoDB ‚Äî –∏–∑–º–µ–Ω–∏—Ç–µ `.env`:

```env
DATABASE_DRIVER=mongodb
```

–ò –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å `mongo`:

```bash
docker-compose --profile mongo up -d
```

---

## üì¶ –°–±–æ—Ä–∫–∞ –∏ –¥–µ–ø–ª–æ–π

### –í—Ä—É—á–Ω—É—é:

```bash
docker-compose --profile postgres --profile frontend-dev up -d --build
```

### –° –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –¥–µ–ø–ª–æ–µ–º:

Workflow `docker-publish.yml` —Å–æ–±–µ—Ä—ë—Ç –∏ –æ–ø—É–±–ª–∏–∫—É–µ—Ç –æ–±—Ä–∞–∑—ã –≤ GHCR –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –ø—É—à–∏ –≤ `main`.

---

## üìù –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|
| `docker-compose --profile postgres --profile frontend-dev up -d --build` | –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ |
| `docker exec -it film-react-nest-backend-1 npm run migration:run` | –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ |
| `docker-compose down` | –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã |
| `docker-compose logs backend` | –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞ |
| `docker exec -it film-postgres psql -U prac -d prac` | –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î |

---

## ‚úÖ –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ

- [x] Docker-–æ–±—Ä–∞–∑—ã –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- [x] Multi-stage —Å–±–æ—Ä–∫–∞
- [x] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π —á–µ—Ä–µ–∑ –ø—Ä–æ—Ñ–∏–ª–∏
- [x] –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ GitHub Actions
- [x] –ú–∏–≥—Ä–∞—Ü–∏–∏ –∏ seed-–¥–∞–Ω–Ω—ã–µ
- [x] –ü—Ä–æ–∫—Å–∏ —á–µ—Ä–µ–∑ Nginx
- [x] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ dev/prod env-—Ñ–∞–π–ª–æ–≤ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

---

## üöÄ –•–æ—Ç–∏—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å?

- [ ] –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–π –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Kubernetes
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ healthcheck endpoint'–æ–≤
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Let's Encrypt —á–µ—Ä–µ–∑ certbot

---

## üí¨ –ê–≤—Ç–æ—Ä

üë§ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä –í–µ–Ω–µ–¥—é—Ö–∏–Ω  
 
üêô [GitHub](https://github.com/Alex-Ven)  
